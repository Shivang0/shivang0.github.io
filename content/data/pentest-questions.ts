import type { Difficulty } from './types'

export type QuestionCategory =
  | 'infrastructure'
  | 'model'
  | 'data'
  | 'api'
  | 'deployment'
  | 'governance'
  | 'integration'
  | 'monitoring'
  | 'agent'
  | 'safety'
  | 'compliance'

export type QuestionPhase =
  | 'pre-engagement'
  | 'reconnaissance'
  | 'assessment'
  | 'post-assessment'

export interface ScopingQuestion {
  id: string
  question: string
  category: QuestionCategory
  phase: QuestionPhase
  importance: 'critical' | 'high' | 'medium' | 'low'
  description: string
  followUpQuestions?: string[]
  relevantTests?: string[]
  notes?: string
}

export const questionCategories: { id: QuestionCategory; label: string; description: string }[] = [
  {
    id: 'infrastructure',
    label: 'Infrastructure',
    description: 'Questions about cloud, network, and compute infrastructure'
  },
  {
    id: 'model',
    label: 'Model Architecture',
    description: 'Questions about ML model design, training, and capabilities'
  },
  {
    id: 'data',
    label: 'Data & Privacy',
    description: 'Questions about training data, user data, and privacy concerns'
  },
  {
    id: 'api',
    label: 'API & Interfaces',
    description: 'Questions about API endpoints, authentication, and rate limiting'
  },
  {
    id: 'deployment',
    label: 'Deployment',
    description: 'Questions about model serving, scaling, and production environment'
  },
  {
    id: 'governance',
    label: 'Governance & Compliance',
    description: 'Questions about policies, regulations, and ethical guidelines'
  },
  {
    id: 'integration',
    label: 'Integration',
    description: 'Questions about third-party integrations, plugins, and tools'
  },
  {
    id: 'monitoring',
    label: 'Monitoring & Logging',
    description: 'Questions about observability, alerts, and audit trails'
  },
  {
    id: 'agent',
    label: 'Autonomous Agents',
    description: 'Questions about AI agents, tool use, and autonomous operations'
  },
  {
    id: 'safety',
    label: 'Safety & Alignment',
    description: 'Questions about guardrails, content moderation, and safety controls'
  },
  {
    id: 'compliance',
    label: 'Regulatory Compliance',
    description: 'Questions about EU AI Act, GDPR, and regulatory requirements'
  }
]

export const scopingQuestions: ScopingQuestion[] = [
  // Infrastructure Questions
  {
    id: 'infra-001',
    question: 'What cloud provider(s) host your AI/ML infrastructure?',
    category: 'infrastructure',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Understanding the cloud environment helps determine attack surface and available security controls.',
    followUpQuestions: [
      'Are you using managed ML services (SageMaker, Vertex AI, Azure ML)?',
      'Is the infrastructure multi-cloud or hybrid?',
      'What regions are deployed?'
    ],
    relevantTests: ['Cloud configuration review', 'IAM policy assessment', 'Network segmentation testing']
  },
  {
    id: 'infra-002',
    question: 'What GPU/TPU infrastructure is used for model training and inference?',
    category: 'infrastructure',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Specialized hardware may have unique security considerations and access patterns.',
    followUpQuestions: [
      'Are GPU clusters shared across teams?',
      'How is GPU memory cleared between jobs?',
      'Are there any custom CUDA kernels in use?'
    ],
    relevantTests: ['GPU memory analysis', 'Side-channel attack assessment', 'Resource isolation testing']
  },
  {
    id: 'infra-003',
    question: 'How is network segmentation implemented between ML components?',
    category: 'infrastructure',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Network isolation prevents lateral movement between training, serving, and data systems.',
    followUpQuestions: [
      'Are training environments isolated from production?',
      'What firewall rules exist between ML services?',
      'Is there VPC peering to other systems?'
    ],
    relevantTests: ['Network penetration testing', 'Firewall rule analysis', 'Traffic analysis']
  },
  {
    id: 'infra-004',
    question: 'What container orchestration platform runs your ML workloads?',
    category: 'infrastructure',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Kubernetes, ECS, or other orchestrators have specific security configurations.',
    followUpQuestions: [
      'What version of Kubernetes is running?',
      'Are pod security policies/standards enforced?',
      'How are secrets managed in containers?'
    ],
    relevantTests: ['Container escape testing', 'Kubernetes RBAC review', 'Image vulnerability scanning']
  },
  {
    id: 'infra-005',
    question: 'Where are model artifacts and checkpoints stored?',
    category: 'infrastructure',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Model storage locations need protection against theft and tampering.',
    followUpQuestions: [
      'Is versioning enabled for model storage?',
      'Who has read/write access to model buckets?',
      'Are models encrypted at rest?'
    ],
    relevantTests: ['Storage access control testing', 'Model integrity verification', 'Backup security review']
  },

  // Model Architecture Questions
  {
    id: 'model-001',
    question: 'What type of model architecture are you using (LLM, Vision, Multi-modal)?',
    category: 'model',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Different architectures have unique attack vectors and security considerations.',
    followUpQuestions: [
      'Is this a foundation model or fine-tuned?',
      'What is the model parameter count?',
      'Are multiple models chained together?'
    ],
    relevantTests: ['Architecture-specific attacks', 'Model fingerprinting', 'Capability assessment']
  },
  {
    id: 'model-002',
    question: 'Is the model using retrieval-augmented generation (RAG)?',
    category: 'model',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'RAG systems have additional attack surface through the retrieval component.',
    followUpQuestions: [
      'What vector database is used?',
      'How is the retrieval corpus curated?',
      'Can users influence what gets retrieved?'
    ],
    relevantTests: ['RAG poisoning tests', 'Retrieval manipulation', 'Context injection attacks']
  },
  {
    id: 'model-003',
    question: 'Does the model have access to external tools or function calling?',
    category: 'model',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Tool-using models can be exploited to perform unauthorized actions.',
    followUpQuestions: [
      'What tools/functions are available to the model?',
      'How are tool calls validated and sanitized?',
      'Can the model execute code?'
    ],
    relevantTests: ['Tool abuse testing', 'Function injection', 'Privilege escalation via tools']
  },
  {
    id: 'model-004',
    question: 'What safety/alignment training has the model received?',
    category: 'model',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Understanding alignment helps assess jailbreak resistance.',
    followUpQuestions: [
      'Was RLHF or Constitutional AI used?',
      'What harmful behavior categories are trained against?',
      'When was the last safety fine-tuning?'
    ],
    relevantTests: ['Jailbreak testing', 'Safety bypass attempts', 'Harmful content generation tests']
  },
  {
    id: 'model-005',
    question: 'Are there any system prompts or hidden instructions?',
    category: 'model',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'System prompts often contain sensitive business logic and can be extracted.',
    followUpQuestions: [
      'How long is the system prompt?',
      'Does it contain any credentials or API keys?',
      'Can the system prompt be modified per-user?'
    ],
    relevantTests: ['Prompt extraction attacks', 'System prompt bypass', 'Instruction hierarchy testing']
  },
  {
    id: 'model-006',
    question: 'What context window length does the model support?',
    category: 'model',
    phase: 'pre-engagement',
    importance: 'medium',
    description: 'Long context windows can be exploited for context manipulation attacks.',
    followUpQuestions: [
      'How is context truncation handled?',
      'Is conversation history persisted?',
      'What happens when context limit is exceeded?'
    ],
    relevantTests: ['Context overflow testing', 'Conversation history manipulation', 'Memory exhaustion']
  },

  // Data & Privacy Questions
  {
    id: 'data-001',
    question: 'What types of data were used to train the model?',
    category: 'data',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Training data composition affects extraction risks and bias concerns.',
    followUpQuestions: [
      'Was PII included in training data?',
      'Were there data licensing restrictions?',
      'How was training data filtered for harmful content?'
    ],
    relevantTests: ['Training data extraction', 'Membership inference', 'PII leakage testing']
  },
  {
    id: 'data-002',
    question: 'How is user conversation data handled and retained?',
    category: 'data',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'User data retention policies affect privacy risks and compliance.',
    followUpQuestions: [
      'What is the data retention period?',
      'Is user data used for further training?',
      'Can users request data deletion?'
    ],
    relevantTests: ['Data retention audit', 'Deletion verification', 'Cross-user data leakage']
  },
  {
    id: 'data-003',
    question: 'Is any sensitive enterprise data accessible to the model?',
    category: 'data',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Enterprise integrations can expose confidential business information.',
    followUpQuestions: [
      'What internal systems can the model query?',
      'Is there document access through RAG?',
      'Are there database connections?'
    ],
    relevantTests: ['Data exfiltration testing', 'Unauthorized access attempts', 'Permission boundary testing']
  },
  {
    id: 'data-004',
    question: 'How are embeddings and vector stores protected?',
    category: 'data',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Embeddings can leak information about the original content.',
    followUpQuestions: [
      'Are embeddings encrypted?',
      'Who has access to the vector database?',
      'Can embeddings be inverted to recover text?'
    ],
    relevantTests: ['Embedding inversion attacks', 'Vector database security', 'Access control testing']
  },
  {
    id: 'data-005',
    question: 'Is differential privacy implemented for training or inference?',
    category: 'data',
    phase: 'pre-engagement',
    importance: 'medium',
    description: 'Differential privacy provides formal guarantees against data extraction.',
    followUpQuestions: [
      'What epsilon value is used?',
      'Is privacy budget tracked?',
      'Are noisy gradients used during training?'
    ],
    relevantTests: ['Privacy budget analysis', 'Membership inference attacks', 'Reconstruction attack attempts']
  },

  // API & Interface Questions
  {
    id: 'api-001',
    question: 'How is API authentication implemented?',
    category: 'api',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Authentication mechanisms protect against unauthorized access.',
    followUpQuestions: [
      'Are API keys or OAuth tokens used?',
      'How are credentials rotated?',
      'Is MFA required for API access?'
    ],
    relevantTests: ['Authentication bypass testing', 'Token security analysis', 'Credential stuffing attempts']
  },
  {
    id: 'api-002',
    question: 'What rate limiting is in place for API endpoints?',
    category: 'api',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Rate limiting prevents abuse and denial of service.',
    followUpQuestions: [
      'What are the rate limit thresholds?',
      'Is rate limiting per-user or per-IP?',
      'How is rate limit bypass detected?'
    ],
    relevantTests: ['Rate limit testing', 'DoS assessment', 'Rate limit bypass attempts']
  },
  {
    id: 'api-003',
    question: 'Is there input validation and sanitization on prompts?',
    category: 'api',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Input validation prevents injection attacks and malicious payloads.',
    followUpQuestions: [
      'What characters/patterns are blocked?',
      'Is there a maximum input length?',
      'Are file uploads allowed?'
    ],
    relevantTests: ['Injection testing', 'Input fuzzing', 'Malicious payload testing']
  },
  {
    id: 'api-004',
    question: 'How are API responses filtered for sensitive content?',
    category: 'api',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Output filtering prevents leakage of harmful or sensitive information.',
    followUpQuestions: [
      'Is there PII detection on outputs?',
      'Are harmful content filters applied?',
      'Can filters be bypassed with encoding?'
    ],
    relevantTests: ['Output filter bypass', 'PII leakage testing', 'Harmful content extraction']
  },
  {
    id: 'api-005',
    question: 'Are there separate endpoints for different user tiers or capabilities?',
    category: 'api',
    phase: 'pre-engagement',
    importance: 'medium',
    description: 'Tiered access should be properly enforced at the API level.',
    followUpQuestions: [
      'What capabilities differ between tiers?',
      'How is tier enforcement implemented?',
      'Can tier restrictions be bypassed?'
    ],
    relevantTests: ['Authorization testing', 'Privilege escalation', 'Tier boundary testing']
  },
  {
    id: 'api-006',
    question: 'Is the API exposed directly to the internet or behind a gateway?',
    category: 'api',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'API gateways provide additional security controls and monitoring.',
    followUpQuestions: [
      'What WAF rules are in place?',
      'Is there bot detection?',
      'Are requests logged and monitored?'
    ],
    relevantTests: ['WAF bypass testing', 'Direct API access attempts', 'Bot detection evasion']
  },

  // Deployment Questions
  {
    id: 'deploy-001',
    question: 'What is the model serving infrastructure (TensorRT, vLLM, TGI)?',
    category: 'deployment',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Serving frameworks have different security characteristics and vulnerabilities.',
    followUpQuestions: [
      'What version of the serving framework?',
      'Are there known CVEs for this version?',
      'Is the serving layer hardened?'
    ],
    relevantTests: ['Framework vulnerability assessment', 'Configuration review', 'Exploit testing']
  },
  {
    id: 'deploy-002',
    question: 'How are model updates deployed to production?',
    category: 'deployment',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Model deployment pipelines can be compromised to inject malicious models.',
    followUpQuestions: [
      'Is there CI/CD for model deployment?',
      'Are models signed and verified?',
      'Who can approve production deployments?'
    ],
    relevantTests: ['Pipeline security review', 'Model tampering tests', 'Deployment access control']
  },
  {
    id: 'deploy-003',
    question: 'Is there a staging or canary deployment environment?',
    category: 'deployment',
    phase: 'pre-engagement',
    importance: 'medium',
    description: 'Non-production environments may have weaker security controls.',
    followUpQuestions: [
      'Is staging data production-like?',
      'Are staging credentials different from production?',
      'Can staging access production resources?'
    ],
    relevantTests: ['Environment isolation testing', 'Credential reuse checks', 'Lateral movement attempts']
  },
  {
    id: 'deploy-004',
    question: 'How is model versioning and rollback handled?',
    category: 'deployment',
    phase: 'pre-engagement',
    importance: 'medium',
    description: 'Rollback capabilities are important for incident response.',
    followUpQuestions: [
      'How quickly can you rollback?',
      'Are previous model versions retained?',
      'Is there version-specific logging?'
    ],
    relevantTests: ['Rollback procedure review', 'Version integrity verification', 'Access control on versions']
  },
  {
    id: 'deploy-005',
    question: 'Are there multiple model replicas for high availability?',
    category: 'deployment',
    phase: 'pre-engagement',
    importance: 'medium',
    description: 'Replica configuration affects consistency and attack surface.',
    followUpQuestions: [
      'How many replicas run concurrently?',
      'Is there geographic distribution?',
      'How is load balancing implemented?'
    ],
    relevantTests: ['Consistency testing', 'Failover security', 'Load balancer bypass']
  },

  // Governance & Compliance Questions
  {
    id: 'gov-001',
    question: 'What regulatory requirements apply (GDPR, HIPAA, SOC2)?',
    category: 'governance',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Compliance requirements define mandatory security controls.',
    followUpQuestions: [
      'Are there specific AI regulations to comply with (EU AI Act)?',
      'What certifications are held or required?',
      'Are there industry-specific requirements?'
    ],
    relevantTests: ['Compliance gap analysis', 'Control effectiveness testing', 'Documentation review']
  },
  {
    id: 'gov-002',
    question: 'Is there an AI ethics review process?',
    category: 'governance',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Ethics reviews help identify potential misuse scenarios.',
    followUpQuestions: [
      'Who conducts ethics reviews?',
      'What criteria are evaluated?',
      'Are there documented use case restrictions?'
    ],
    relevantTests: ['Policy review', 'Restricted use case testing', 'Misuse scenario assessment']
  },
  {
    id: 'gov-003',
    question: 'How are model decisions explained and documented?',
    category: 'governance',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Explainability requirements affect logging and audit capabilities.',
    followUpQuestions: [
      'Is there a model card or documentation?',
      'Are individual predictions logged?',
      'Can users request explanations?'
    ],
    relevantTests: ['Explanation manipulation', 'Documentation accuracy', 'Audit trail completeness']
  },
  {
    id: 'gov-004',
    question: 'What is the incident response plan for AI-specific issues?',
    category: 'governance',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'AI incidents require specialized response procedures.',
    followUpQuestions: [
      'Who is on the AI incident response team?',
      'What constitutes an AI security incident?',
      'How quickly can the model be taken offline?'
    ],
    relevantTests: ['Response time assessment', 'Communication channel testing', 'Escalation procedure review']
  },
  {
    id: 'gov-005',
    question: 'Are there acceptable use policies for the AI system?',
    category: 'governance',
    phase: 'pre-engagement',
    importance: 'medium',
    description: 'AUPs define boundaries that should be technically enforced.',
    followUpQuestions: [
      'What uses are prohibited?',
      'How are violations detected?',
      'What are the consequences of violations?'
    ],
    relevantTests: ['Policy enforcement testing', 'Prohibited use attempts', 'Detection capability assessment']
  },

  // Integration Questions
  {
    id: 'int-001',
    question: 'What third-party APIs does the model interact with?',
    category: 'integration',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'External integrations expand the attack surface significantly.',
    followUpQuestions: [
      'How are API credentials stored?',
      'What data is sent to third parties?',
      'Are there fallback mechanisms if APIs fail?'
    ],
    relevantTests: ['Integration security review', 'Credential exposure testing', 'SSRF via integrations']
  },
  {
    id: 'int-002',
    question: 'Are there plugins or extensions that can be added?',
    category: 'integration',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Plugin systems can introduce untrusted code execution.',
    followUpQuestions: [
      'How are plugins vetted and approved?',
      'What permissions do plugins have?',
      'Can users install custom plugins?'
    ],
    relevantTests: ['Plugin security review', 'Malicious plugin testing', 'Permission boundary testing']
  },
  {
    id: 'int-003',
    question: 'Is the model integrated with internal enterprise systems?',
    category: 'integration',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Enterprise integrations can provide access to sensitive internal resources.',
    followUpQuestions: [
      'What systems can the model access (email, docs, databases)?',
      'Are there service accounts used for integrations?',
      'Is there row-level security on data access?'
    ],
    relevantTests: ['Unauthorized access testing', 'Service account abuse', 'Data exfiltration attempts']
  },
  {
    id: 'int-004',
    question: 'How do webhooks and callbacks work?',
    category: 'integration',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Webhooks can be exploited for SSRF and data exfiltration.',
    followUpQuestions: [
      'Are webhook destinations validated?',
      'What data is included in webhooks?',
      'Are webhooks authenticated?'
    ],
    relevantTests: ['SSRF testing', 'Webhook manipulation', 'Exfiltration via callbacks']
  },
  {
    id: 'int-005',
    question: 'Are there browser or mobile integrations?',
    category: 'integration',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Client-side integrations have additional security considerations.',
    followUpQuestions: [
      'Is there a browser extension?',
      'What permissions do client integrations require?',
      'Is client-side prompt caching used?'
    ],
    relevantTests: ['Client-side security review', 'Permission abuse testing', 'Local data exposure']
  },

  // Monitoring Questions
  {
    id: 'mon-001',
    question: 'What logging is in place for model inputs and outputs?',
    category: 'monitoring',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Comprehensive logging is essential for security monitoring and forensics.',
    followUpQuestions: [
      'Are full prompts and responses logged?',
      'How long are logs retained?',
      'Is PII redacted from logs?'
    ],
    relevantTests: ['Log completeness assessment', 'Log tampering attempts', 'Sensitive data in logs']
  },
  {
    id: 'mon-002',
    question: 'Are there anomaly detection systems for unusual usage patterns?',
    category: 'monitoring',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Anomaly detection helps identify attacks and misuse in progress.',
    followUpQuestions: [
      'What patterns trigger alerts?',
      'How quickly are anomalies investigated?',
      'Is there ML-based detection?'
    ],
    relevantTests: ['Detection evasion testing', 'Alert threshold testing', 'False positive analysis']
  },
  {
    id: 'mon-003',
    question: 'How are prompt injection attempts detected and logged?',
    category: 'monitoring',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Injection detection is critical for protecting LLM applications.',
    followUpQuestions: [
      'What injection patterns are detected?',
      'Is there real-time blocking or just logging?',
      'How often are detection rules updated?'
    ],
    relevantTests: ['Detection bypass testing', 'New injection technique testing', 'Rule coverage assessment']
  },
  {
    id: 'mon-004',
    question: 'Is there monitoring for model performance degradation or drift?',
    category: 'monitoring',
    phase: 'pre-engagement',
    importance: 'medium',
    description: 'Performance drift may indicate attacks or data poisoning.',
    followUpQuestions: [
      'What metrics are tracked?',
      'Are there automated alerts for drift?',
      'How is baseline performance established?'
    ],
    relevantTests: ['Drift simulation', 'Metric manipulation', 'Alert threshold testing']
  },
  {
    id: 'mon-005',
    question: 'How are security events correlated across the ML stack?',
    category: 'monitoring',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Correlation helps identify sophisticated multi-stage attacks.',
    followUpQuestions: [
      'Is there a SIEM integration?',
      'Are model events correlated with infrastructure events?',
      'What is the mean time to detect (MTTD)?'
    ],
    relevantTests: ['Multi-stage attack simulation', 'Alert correlation testing', 'Detection gap analysis']
  },

  // Assessment Phase Questions
  {
    id: 'assess-001',
    question: 'What is the testing window and approved hours?',
    category: 'governance',
    phase: 'assessment',
    importance: 'critical',
    description: 'Testing windows ensure minimal disruption and proper coordination.',
    followUpQuestions: [
      'Are there blackout periods?',
      'What timezone for testing hours?',
      'Who should be notified during testing?'
    ],
    relevantTests: ['All testing activities'],
    notes: 'Critical for rules of engagement'
  },
  {
    id: 'assess-002',
    question: 'What accounts and access levels will be provided for testing?',
    category: 'api',
    phase: 'assessment',
    importance: 'critical',
    description: 'Test accounts should mirror realistic user access.',
    followUpQuestions: [
      'Are there multiple tier test accounts?',
      'Is there an admin test account?',
      'Are test accounts monitored separately?'
    ],
    relevantTests: ['All authentication and authorization tests']
  },
  {
    id: 'assess-003',
    question: 'Is there a dedicated test environment or will testing be on production?',
    category: 'deployment',
    phase: 'assessment',
    importance: 'critical',
    description: 'Test environment isolation prevents production impact.',
    followUpQuestions: [
      'Is test data production-like?',
      'Are there shared resources with production?',
      'Can test actions affect real users?'
    ],
    relevantTests: ['All destructive or high-impact tests']
  },
  {
    id: 'assess-004',
    question: 'What is the emergency contact procedure if issues are discovered?',
    category: 'governance',
    phase: 'assessment',
    importance: 'critical',
    description: 'Clear escalation paths enable rapid response to critical findings.',
    followUpQuestions: [
      'Who are the primary and secondary contacts?',
      'What communication channels are preferred?',
      'What constitutes an emergency finding?'
    ],
    relevantTests: ['Critical vulnerability discovery scenarios']
  },

  // Post-Assessment Questions
  {
    id: 'post-001',
    question: 'What is the preferred format and detail level for the report?',
    category: 'governance',
    phase: 'post-assessment',
    importance: 'high',
    description: 'Report format should meet stakeholder needs.',
    followUpQuestions: [
      'Is there a required report template?',
      'Should findings include proof-of-concept code?',
      'Who will receive the report?'
    ],
    relevantTests: ['N/A - Reporting requirement']
  },
  {
    id: 'post-002',
    question: 'What is the process for validating remediation of findings?',
    category: 'governance',
    phase: 'post-assessment',
    importance: 'high',
    description: 'Remediation verification ensures issues are properly fixed.',
    followUpQuestions: [
      'Is retesting included in scope?',
      'How will remediation timeline be tracked?',
      'Who approves closure of findings?'
    ],
    relevantTests: ['Remediation validation testing']
  },
  {
    id: 'post-003',
    question: 'Are there data handling requirements for assessment artifacts?',
    category: 'data',
    phase: 'post-assessment',
    importance: 'high',
    description: 'Test data and artifacts may contain sensitive information.',
    followUpQuestions: [
      'Should test data be destroyed after assessment?',
      'Are there retention requirements for evidence?',
      'How should sensitive findings be transmitted?'
    ],
    relevantTests: ['N/A - Data handling requirement']
  },

  // Autonomous Agent Questions
  {
    id: 'agent-001',
    question: 'What agent framework is being used (LangChain, AutoGPT, CrewAI, custom)?',
    category: 'agent',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Different agent frameworks have different security characteristics and known vulnerabilities.',
    followUpQuestions: [
      'What version of the framework?',
      'Are there any custom modifications?',
      'Have known CVEs been addressed?'
    ],
    relevantTests: ['Framework vulnerability assessment', 'Configuration review', 'Known exploit testing']
  },
  {
    id: 'agent-002',
    question: 'How is agent memory implemented (short-term, long-term, episodic)?',
    category: 'agent',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Agent memory systems can be poisoned or manipulated to influence future behavior.',
    followUpQuestions: [
      'Where is memory stored?',
      'How long is memory retained?',
      'Can memory be modified by users?'
    ],
    relevantTests: ['Memory poisoning attacks', 'Persistence testing', 'Memory isolation testing']
  },
  {
    id: 'agent-003',
    question: 'What tools and functions can the agent access?',
    category: 'agent',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Tool access determines the potential impact of agent compromise.',
    followUpQuestions: [
      'Can the agent execute code?',
      'Does the agent have file system access?',
      'Can the agent make network requests?'
    ],
    relevantTests: ['Tool abuse testing', 'Unauthorized action attempts', 'Capability escalation']
  },
  {
    id: 'agent-004',
    question: 'How is memory poisoning prevented?',
    category: 'agent',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Memory poisoning allows attackers to persistently influence agent behavior.',
    followUpQuestions: [
      'Is memory content validated?',
      'Are there integrity checks on stored memories?',
      'Can external content enter memory?'
    ],
    relevantTests: ['Memory injection attacks', 'Persistence bypass', 'Memory integrity testing']
  },
  {
    id: 'agent-005',
    question: 'What prevents goal modification attacks?',
    category: 'agent',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Goal hijacking redirects agents from intended objectives to attacker goals.',
    followUpQuestions: [
      'Are goals hardcoded or dynamic?',
      'Can user input influence goals?',
      'How are goal priorities enforced?'
    ],
    relevantTests: ['Goal hijacking attempts', 'Priority manipulation', 'Objective injection']
  },
  {
    id: 'agent-006',
    question: 'Are there human-in-the-loop checkpoints for sensitive operations?',
    category: 'agent',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Human approval gates prevent autonomous escalation of harmful actions.',
    followUpQuestions: [
      'What operations require human approval?',
      'Can approval requirements be bypassed?',
      'What is the timeout for approvals?'
    ],
    relevantTests: ['Approval bypass testing', 'Timeout exploitation', 'Checkpoint circumvention']
  },
  {
    id: 'agent-007',
    question: 'What emergency stop mechanisms exist?',
    category: 'agent',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Kill switches are essential for stopping runaway agent behavior.',
    followUpQuestions: [
      'How quickly can agents be stopped?',
      'Who has authority to trigger emergency stop?',
      'Are there automated stop conditions?'
    ],
    relevantTests: ['Emergency stop effectiveness', 'Kill switch bypass', 'Automated stop trigger testing']
  },
  {
    id: 'agent-008',
    question: 'How is agent-to-agent communication secured?',
    category: 'agent',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Multi-agent systems can have communication channels exploited.',
    followUpQuestions: [
      'Can agents communicate with each other?',
      'Is inter-agent communication authenticated?',
      'Can external parties inject messages?'
    ],
    relevantTests: ['Message injection', 'Agent impersonation', 'Communication channel security']
  },
  {
    id: 'agent-009',
    question: 'Are there replay attack protections for agent actions?',
    category: 'agent',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Replay attacks can cause agents to repeat sensitive operations.',
    followUpQuestions: [
      'Are action requests timestamped?',
      'Is there nonce/idempotency protection?',
      'How are duplicate actions detected?'
    ],
    relevantTests: ['Replay attack testing', 'Duplicate action exploitation', 'Timestamp manipulation']
  },
  {
    id: 'agent-010',
    question: 'How is agent sandboxing implemented?',
    category: 'agent',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Sandbox escapes allow agents to access unauthorized resources.',
    followUpQuestions: [
      'What containerization is used?',
      'Are there filesystem restrictions?',
      'What network access is allowed?'
    ],
    relevantTests: ['Sandbox escape testing', 'Container breakout', 'Network isolation testing']
  },

  // Safety & Alignment Questions
  {
    id: 'safety-001',
    question: 'What input guardrails are implemented?',
    category: 'safety',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Input guardrails are the first line of defense against harmful prompts.',
    followUpQuestions: [
      'Is there prompt classification?',
      'Are known jailbreak patterns detected?',
      'What categories are blocked?'
    ],
    relevantTests: ['Guardrail bypass testing', 'Input filter evasion', 'Pattern detection assessment']
  },
  {
    id: 'safety-002',
    question: 'How are jailbreak attempts detected?',
    category: 'safety',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Jailbreak detection identifies attempts to bypass safety training.',
    followUpQuestions: [
      'What detection methods are used?',
      'Is there ML-based detection?',
      'How often are detectors updated?'
    ],
    relevantTests: ['Known jailbreak testing', 'Novel jailbreak attempts', 'Detection evasion']
  },
  {
    id: 'safety-003',
    question: 'What topic restrictions are enforced?',
    category: 'safety',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Topic restrictions limit what the model will discuss.',
    followUpQuestions: [
      'Is there a list of prohibited topics?',
      'How are edge cases handled?',
      'Can restrictions be modified per-user?'
    ],
    relevantTests: ['Topic restriction bypass', 'Boundary testing', 'Edge case exploitation']
  },
  {
    id: 'safety-004',
    question: 'Has guardrail bypass testing been conducted?',
    category: 'safety',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Understanding previous testing helps identify coverage gaps.',
    followUpQuestions: [
      'When was the last red team assessment?',
      'What bypass methods were tested?',
      'Were issues remediated?'
    ],
    relevantTests: ['Known bypass retesting', 'New technique testing', 'Remediation validation']
  },
  {
    id: 'safety-005',
    question: 'What output content moderation is applied?',
    category: 'safety',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Output moderation prevents harmful content generation.',
    followUpQuestions: [
      'Is there real-time filtering?',
      'What categories are flagged?',
      'Can moderation be bypassed with encoding?'
    ],
    relevantTests: ['Output filter bypass', 'Encoding attacks', 'Category coverage testing']
  },
  {
    id: 'safety-006',
    question: 'Is toxicity detection implemented?',
    category: 'safety',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Toxicity detection prevents harmful, abusive, or offensive outputs.',
    followUpQuestions: [
      'What toxicity classifier is used?',
      'What is the detection threshold?',
      'How are false positives handled?'
    ],
    relevantTests: ['Toxicity detection evasion', 'Threshold manipulation', 'False positive analysis']
  },
  {
    id: 'safety-007',
    question: 'How is PII detection implemented in outputs?',
    category: 'safety',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'PII detection prevents leakage of personal information.',
    followUpQuestions: [
      'What PII types are detected?',
      'Is there entity recognition?',
      'How is detected PII handled?'
    ],
    relevantTests: ['PII leakage testing', 'Entity extraction bypass', 'Detection coverage assessment']
  },
  {
    id: 'safety-008',
    question: 'Is bias testing conducted on model outputs?',
    category: 'safety',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Bias testing identifies discriminatory or unfair outputs.',
    followUpQuestions: [
      'What bias categories are tested?',
      'How frequently is testing done?',
      'Are there automated bias checks?'
    ],
    relevantTests: ['Bias elicitation testing', 'Fairness assessment', 'Demographic parity analysis']
  },

  // Regulatory Compliance Questions
  {
    id: 'comp-001',
    question: 'What is the EU AI Act risk category for this system?',
    category: 'compliance',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'EU AI Act risk categorization determines compliance requirements.',
    followUpQuestions: [
      'Has formal risk assessment been conducted?',
      'Are there high-risk use cases?',
      'What is the primary deployment region?'
    ],
    relevantTests: ['Risk categorization validation', 'Control gap analysis', 'Documentation review']
  },
  {
    id: 'comp-002',
    question: 'What conformity assessment requirements apply?',
    category: 'compliance',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'High-risk AI systems require conformity assessments under EU AI Act.',
    followUpQuestions: [
      'Is third-party assessment required?',
      'What technical documentation exists?',
      'Are there notified body requirements?'
    ],
    relevantTests: ['Documentation completeness', 'Technical requirement validation', 'Process review']
  },
  {
    id: 'comp-003',
    question: 'What transparency obligations must be met?',
    category: 'compliance',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'AI systems have disclosure requirements about their nature and capabilities.',
    followUpQuestions: [
      'Is AI nature disclosed to users?',
      'Are limitations documented?',
      'Is there a model card or fact sheet?'
    ],
    relevantTests: ['Disclosure compliance', 'Documentation accuracy', 'User notification testing']
  },
  {
    id: 'comp-004',
    question: 'How does GDPR apply to this AI system?',
    category: 'compliance',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'GDPR has specific requirements for AI processing of personal data.',
    followUpQuestions: [
      'Is personal data used in training?',
      'Are there automated decisions affecting individuals?',
      'Is right to explanation required?'
    ],
    relevantTests: ['Data processing review', 'Rights implementation testing', 'Consent verification']
  },
  {
    id: 'comp-005',
    question: 'Are there HIPAA or healthcare AI requirements?',
    category: 'compliance',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Healthcare AI has strict requirements under HIPAA and FDA guidance.',
    followUpQuestions: [
      'Does the system process PHI?',
      'Is there a BAA requirement?',
      'Does FDA medical device regulation apply?'
    ],
    relevantTests: ['PHI handling review', 'BAA compliance verification', 'FDA requirement assessment']
  },
  {
    id: 'comp-006',
    question: 'What financial regulations apply (SOX, GLBA, PCI-DSS)?',
    category: 'compliance',
    phase: 'pre-engagement',
    importance: 'critical',
    description: 'Financial AI systems have extensive regulatory requirements.',
    followUpQuestions: [
      'Is financial data processed?',
      'Are there model risk management requirements?',
      'Is there SR 11-7 applicability?'
    ],
    relevantTests: ['Financial data handling', 'Model governance review', 'Regulatory control testing']
  },
  {
    id: 'comp-007',
    question: 'Is NIST AI RMF being followed?',
    category: 'compliance',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'NIST AI Risk Management Framework provides structured approach to AI governance.',
    followUpQuestions: [
      'Which AI RMF functions are implemented?',
      'Is there formal risk assessment documentation?',
      'How is risk measured and tracked?'
    ],
    relevantTests: ['Framework implementation review', 'Risk documentation audit', 'Control effectiveness testing']
  },
  {
    id: 'comp-008',
    question: 'What is the ISO 42001 certification status?',
    category: 'compliance',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'ISO 42001 is the international standard for AI management systems.',
    followUpQuestions: [
      'Is certification in progress or achieved?',
      'What AIMS controls are implemented?',
      'Are there third-party audits?'
    ],
    relevantTests: ['Control implementation review', 'Documentation assessment', 'Audit finding review']
  },
  {
    id: 'comp-009',
    question: 'Are there SOC 2 AI-specific controls?',
    category: 'compliance',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'SOC 2 reports increasingly include AI-specific controls.',
    followUpQuestions: [
      'Is there a recent SOC 2 report?',
      'Are AI controls covered?',
      'What is the scope of the report?'
    ],
    relevantTests: ['SOC 2 control testing', 'Gap analysis', 'Control evidence review']
  },
  {
    id: 'comp-010',
    question: 'How is algorithmic impact assessment conducted?',
    category: 'compliance',
    phase: 'pre-engagement',
    importance: 'high',
    description: 'Impact assessments identify potential harms and mitigation strategies.',
    followUpQuestions: [
      'Is there a formal AIA process?',
      'Who conducts the assessment?',
      'How often are assessments updated?'
    ],
    relevantTests: ['Assessment process review', 'Harm identification validation', 'Mitigation effectiveness']
  }
]

// Helper functions
export const getQuestionsByCategory = (category: QuestionCategory): ScopingQuestion[] => {
  return scopingQuestions.filter(q => q.category === category)
}

export const getQuestionsByPhase = (phase: QuestionPhase): ScopingQuestion[] => {
  return scopingQuestions.filter(q => q.phase === phase)
}

export const getQuestionsByImportance = (importance: 'critical' | 'high' | 'medium' | 'low'): ScopingQuestion[] => {
  return scopingQuestions.filter(q => q.importance === importance)
}

export const getCriticalQuestions = (): ScopingQuestion[] => {
  return scopingQuestions.filter(q => q.importance === 'critical')
}

// Stats
export const questionStats = {
  totalQuestions: scopingQuestions.length,
  byCategory: questionCategories.reduce((acc, cat) => {
    acc[cat.id] = getQuestionsByCategory(cat.id).length
    return acc
  }, {} as Record<QuestionCategory, number>),
  byPhase: {
    'pre-engagement': getQuestionsByPhase('pre-engagement').length,
    reconnaissance: getQuestionsByPhase('reconnaissance').length,
    assessment: getQuestionsByPhase('assessment').length,
    'post-assessment': getQuestionsByPhase('post-assessment').length,
  },
  byImportance: {
    critical: getQuestionsByImportance('critical').length,
    high: getQuestionsByImportance('high').length,
    medium: getQuestionsByImportance('medium').length,
    low: getQuestionsByImportance('low').length,
  }
}
